<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>SPACE TETRIS ‚Äì Full Features Edition</title>

<style>
/* -------------------- GENERAL PAGE STYLE -------------------- */
html, body {
  margin: 0;
  padding: 0;
  background: black;
  height: 100%;
  font-family: 'Arial', sans-serif;
  overflow: hidden;
  touch-action: none;
}

/* -------------------- CONTAINER -------------------- */
#game-container {
  width: 100vw;
  height: 100vh;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
}

/* -------------------- LOGO PIXEL ART -------------------- */
#logo {
  font-size: 32px;
  color: #6fbaff;
  font-weight: bold;
  margin-top: 10px;
  letter-spacing: 4px;
  text-shadow: 0 0 6px #3d7bff, 0 0 12px #6fbaff;
  image-rendering: pixelated;
}

/* -------------------- CANVAS -------------------- */
#tetris {
  width: 90vw;
  height: 68vh;
  max-width: 420px;
  margin-top: 10px;
  background: #000;
  border: 4px solid #6fbaff;
  box-shadow: 0 0 20px #6fbaff;
}

/* -------------------- UI -------------------- */
#ui {
  color: white;
  font-size: 18px;
  width: 100%;
  text-align: center;
  margin-top: 6px;
}

/* -------------------- CONTROLS -------------------- */
#controls {
  width: 100%;
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 14px;
}

.control-btn {
  width: 62px;
  height: 62px;
  background: #111;
  border: 3px solid #6fbaff;
  border-radius: 8px;
  font-size: 34px;
  color: #6fbaff;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 0 15px #6fbaff;
  image-rendering: pixelated;
}

.control-btn:active {
  transform: scale(0.93);
  filter: brightness(1.4);
}

/* -------------------- START BUTTON -------------------- */
#startBtn {
  margin-top: 15px;
  width: 150px;
  padding: 10px;
  border: 3px solid #6fbaff;
  color: #6fbaff;
  background: #000;
  font-size: 22px;
  text-align: center;
  border-radius: 6px;
  box-shadow: 0 0 15px #6fbaff;
  image-rendering: pixelated;
}

#startBtn:active {
  transform: scale(0.94);
  filter: brightness(1.3);
}

/* -------------------- PIXELATION -------------------- */
img, canvas {
  image-rendering: pixelated;
}
</style>
</head>

<body>

<div id="game-container">

  <!-- LOGO PIXEL ART -->
  <div id="logo">SPACE TETRIS</div>

  <!-- UI -->
  <div id="ui">
    Score: <span id="score">0</span> |
    Level: <span id="level">1</span> |
    Time: <span id="time">0</span>s
  </div>

  <!-- CANVAS -->
  <canvas id="tetris" width="300" height="600"></canvas>

  <!-- TOUCH CONTROLS -->
  <div id="controls">
    <div class="control-btn" id="left">‚¨ÖÔ∏è</div>
    <div class="control-btn" id="rotate">üîÑ</div>
    <div class="control-btn" id="right">‚û°Ô∏è</div>
    <div class="control-btn" id="down">‚¨áÔ∏è</div>
  </div>

  <!-- START BUTTON -->
  <div id="startBtn">START</div>

</div>

<script>
/* -------------------- VARIABLES -------------------- */
const canvas = document.getElementById("tetris");
const ctx = canvas.getContext("2d");

let score = 0;
let level = 1;
let timer = 0;

let gridW = 10;
let gridH = 20;
let block = 30;

let grid = [];

const shapes = [
  [[1,1,1,1]],
  [[1,1],[1,1]],
  [[0,1,0],[1,1,1]],
  [[1,0],[1,0],[1,1]],
  [[0,1],[0,1],[1,1]]
];

const colors = ["#6fbaff","#8ac9ff","#b5dcff","#d6ecff","#ffffff"];

/* -------------------- INIT GRID -------------------- */
function initGrid() {
  grid = Array(gridH).fill().map(()=>Array(gridW).fill(0));
}

/* -------------------- PIECES -------------------- */
let piece, px, py;

function newPiece() {
  piece = shapes[Math.floor(Math.random()*shapes.length)];
  px = 3;
  py = 0;
}

/* ROTATION */
function rotate(p) {
  return p[0].map((_,i)=>p.map(r=>r[i]).reverse());
}

/* COLLISION CHECK */
function collides(nx, ny, p) {
  for (let y=0;y<p.length;y++) {
    for(let x=0;x<p[y].length;x++) {
      if (p[y][x] &&
         (nx+x<0 || nx+x>=gridW || ny+y>=gridH || grid[ny+y][nx+x])) {
        return true;
      }
    }
  }
  return false;
}

/* MERGE */
function merge() {
  piece.forEach((row,y)=>
    row.forEach((v,x)=>{ if(v){ grid[py+y][px+x] = 1; }})
  );
}

/* CLEAR LINES */
function clearLines() {
  for (let y=gridH-1;y>=0;y--) {
    if(grid[y].every(v=>v)) {
      grid.splice(y,1);
      grid.unshift(Array(gridW).fill(0));
      score += 100;
      level = Math.floor(score/500)+1;

      /* VIBRATION */
      if (navigator.vibrate) navigator.vibrate(100);
    }
  }
  document.getElementById("score").textContent = score;
  document.getElementById("level").textContent = level;
}

/* STARFIELD */
let stars = [];
for (let i=0;i<120;i++){
  stars.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    size:Math.random()*2,
    speed:0.3+Math.random()*0.5
  });
}

function drawStars() {
  ctx.fillStyle="white";
  stars.forEach(s=>{
    ctx.globalAlpha=0.2+Math.random()*0.5;
    ctx.fillRect(s.x,s.y,s.size,s.size);
    s.y+=s.speed;
    if(s.y>canvas.height) s.y=0;
  });
  ctx.globalAlpha=1;
}

/* DRAW GRID AND PIECE */
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawStars();

  /* GRID */
  for (let y=0;y<gridH;y++){
    for (let x=0;x<gridW;x++){
      if(grid[y][x]){
        ctx.fillStyle=colors[(x+y)%colors.length];
        ctx.fillRect(x*block,y*block,block-1,block-1);
      }
    }
  }

  /* PIECE */
  piece.forEach((row,y)=>
    row.forEach((v,x)=>{
      if(v){
        ctx.fillStyle=colors[(x+y)%colors.length];
        ctx.fillRect((px+x)*block,(py+y)*block,block-1,block-1);
      }
    })
  );
}

/* GAME LOOP */
let drop=0,last=0,paused=true;

function update(t){
  requestAnimationFrame(update);
  if(paused) return;

  const d=t-last; last=t;
  drop+=d;

  if(drop > 900 - level*70){
    py++;
    drop=0;

    if(collides(px,py,piece)){
      py--;
      merge();
      clearLines();
      newPiece();

      if(collides(px,py,piece)){
        alert("GAME OVER! Score: "+score);
        location.reload();
      }
    }
  }

  draw();
}

/* START GAME */
document.getElementById("startBtn").onclick = ()=>{
  paused=false;
  initGrid();
  newPiece();
  score=0; level=1; timer=0;
  document.getElementById("startBtn").style.display="none";
};

/* TIMER */
setInterval(()=>{
  if(!paused){
    timer++;
    document.getElementById("time").textContent = timer;
  }
},1000);

/* TOUCH CONTROLS */
document.getElementById("left").onclick=()=>{ if(!collides(px-1,py,piece)) px--; };
document.getElementById("right").onclick=()=>{ if(!collides(px+1,py,piece)) px++; };
document.getElementById("rotate").onclick=()=>{ let r=rotate(piece); if(!collides(px,py,r)) piece=r; };
document.getElementById("down").onclick=()=>{ py++; if(collides(px,py,piece)) py--; };

update(0);
</script>

</body>
</html>
