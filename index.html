<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Space Tetris</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      color: white;
      font-family: sans-serif;
      height: 100%;
      overflow: hidden;
    }

    .btn {
      margin: 10px;
      padding: 10px 20px;
      font-size: 1.3em;
      background: #111;
      border: 2px solid #6fbaff;
      border-radius: 10px;
      color: #6fbaff;
      transition: 0.1s;
    }

    .btn:active {
      transform: scale(0.95);
      box-shadow: 0 0 12px #6fbaff;
    }

    #start-screen {
      position: absolute;
      inset: 0;
      background: black;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    #game-ui {
      display: none;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    canvas {
      border: 3px solid #6fbaff;
      box-shadow: 0 0 15px #6fbaff;
      background: black;
      width: 90vw;
      max-width: 420px;
      aspect-ratio: 10/20;
    }

    #control-buttons {
      margin-top: 15px;
      display: none;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    #scorebar {
      color: white;
      font-size: 1.2em;
      margin-top: 10px;
    }

    #highscore {
      font-size: 0.9em;
      opacity: 0.7;
    }
  </style>
</head>
<body>

<!-- START SCREEN -->
<div id="start-screen">
  <h1 style="font-size:8vw; margin-bottom:5vh; text-shadow:0 0 10px #6fbaff;">SPACE TETRIS</h1>
  <button class="btn" onclick="launchGame()">START</button>
</div>

<!-- GAME UI -->
<div id="game-ui">
  <div id="scorebar">
    Score: <span id="score">0</span> |
    High Score: <span id="highscore">0</span>
  </div>
  <canvas id="tetris" width="300" height="600"></canvas>
  <div id="control-buttons">
    <button class="btn" onclick="moveLeft()">‚¨ÖÔ∏è</button>
    <button class="btn" onclick="rotatePiece()">üîÑ</button>
    <button class="btn" onclick="moveRight()">‚û°Ô∏è</button>
    <button class="btn" onclick="hardDrop()">‚¨áÔ∏è</button>
    <button class="btn" onclick="togglePause()">‚è∏Ô∏è</button>
    <button class="btn" onclick="launchGame()">üîÑ</button>
  </div>
</div>

<script>
  const canvas = document.getElementById("tetris");
  const ctx = canvas.getContext("2d");

  const COLS = 10, ROWS = 20;
  const BLOCK = canvas.width / COLS;

  const shapes = [
    { color: "#00f0f0", shape: [[1,1,1,1]] },          // I
    { color: "#f0f000", shape: [[1,1],[1,1]] },        // O
    { color: "#8000f0", shape: [[0,1,0],[1,1,1]] },    // T
    { color: "#f00000", shape: [[1,0,0],[1,1,1]] },    // J
    { color: "#0000f0", shape: [[0,0,1],[1,1,1]] },    // L
    { color: "#00f000", shape: [[1,1,0],[0,1,1]] },    // S
    { color: "#f0a000", shape: [[0,1,1],[1,1,0]] }     // Z
  ];

  let grid, current, px, py, score = 0, highScore = 0;
  let dropInterval = 800, dropTimer = 0, lastTime = 0;
  let paused = false, currentColor = "#6fbaff";

  function initGrid() {
    grid = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
  }

  function newPiece() {
    let tetromino = shapes[Math.floor(Math.random() * shapes.length)];
    current = tetromino.shape;
    currentColor = tetromino.color;
    px = 3;
    py = 0;
    if (collides(px, py, current)) {
      alert("Game Over!");
      updateHighScore();
      launchGame(); // Restart
    }
  }

  function rotate(matrix) {
    return matrix[0].map((_, i) => matrix.map(row => row[i])).reverse();
  }

  function collides(x, y, shape) {
    for (let r = 0; r < shape.length; r++) {
      for (let c = 0; c < shape[r].length; c++) {
        if (shape[r][c]) {
          const newY = y + r;
          const newX = x + c;
          if (newY >= ROWS || newX < 0 || newX >= COLS || grid[newY][newX]) {
            return true;
          }
        }
      }
    }
    return false;
  }

  function merge() {
    current.forEach((row, y) => {
      row.forEach((val, x) => {
        if (val) grid[py + y][px + x] = currentColor;
      });
    });
  }

  function clearLines() {
    for (let y = ROWS - 1; y >= 0; y--) {
      if (grid[y].every(cell => cell)) {
        grid.splice(y, 1);
        grid.unshift(Array(COLS).fill(0));
        y++;
        score += 100;
        document.getElementById('score').textContent = score;
      }
    }
  }

  function drawMatrix(matrix, offsetX, offsetY, color) {
    matrix.forEach((row, y) => {
      row.forEach((val, x) => {
        if (val) {
          ctx.fillStyle = color;
          ctx.fillRect((offsetX + x) * BLOCK, (offsetY + y) * BLOCK, BLOCK - 1, BLOCK - 1);
        }
      });
    });
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let y = 0; y < ROWS; y++) {
      for (let x = 0; x < COLS; x++) {
        if (grid[y][x]) {
          ctx.fillStyle = grid[y][x];
          ctx.fillRect(x * BLOCK, y * BLOCK, BLOCK - 1, BLOCK - 1);
        }
      }
    }
    drawMatrix(current, px, py, currentColor);
  }

  function update(t = 0) {
    if (paused) return;
    const delta = t - lastTime;
    lastTime = t;
    dropTimer += delta;
    if (dropTimer > dropInterval) {
      py++;
      if (collides(px, py, current)) {
        py--;
        merge();
        clearLines();
        newPiece();
      }
      dropTimer = 0;
    }
    draw();
    requestAnimationFrame(update);
  }

  function startGame() {
    score = 0;
    dropTimer = 0;
    lastTime = 0;
    paused = false;
    document.getElementById('score').textContent = score;
    highScore = parseInt(localStorage.getItem("highScore")) || 0;
    document.getElementById('highscore').textContent = highScore;
    initGrid();
    newPiece();
    update();
  }

  function launchGame() {
    document.getElementById("start-screen").style.display = "none";
    document.getElementById("game-ui").style.display = "flex";
    document.getElementById("control-buttons").style.display = "flex";
    startGame();
  }

  function updateHighScore() {
    if (score > highScore) {
      localStorage.setItem("highScore", score);
    }
  }

  function togglePause() {
    paused = !paused;
    if (!paused) update();
  }

  function moveLeft() {
    if (!collides(px - 1, py, current)) px--;
  }

  function moveRight() {
    if (!collides(px + 1, py, current)) px++;
  }

  function rotatePiece() {
    const rotated = rotate(current);
    if (!collides(px, py, rotated)) current = rotated;
  }

  function hardDrop() {
    while (!collides(px, py + 1, current)) {
      py++;
    }
  }
</script>

</body>
</html>
