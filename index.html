<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>Space Tetris ‚Äì Mobile Optimized</title>

<style>
  body {
    margin: 0;
    background: #000;
    font-family: Arial, sans-serif;
    overflow: hidden;
    color: white;
  }

  #game-container {
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 10px;
  }

  #tetris {
    width: 92vw;
    max-width: 420px;
    height: auto;
    border: 4px solid #f2a42d;
    background: black;
    box-shadow: 0 0 20px #f2a42d;
  }

  #ui {
    margin: 10px 0 6px;
    font-size: 18px;
    text-align: center;
  }

  #controls {
    display: flex;
    justify-content: center;
    gap: 18px;
    margin-top: 12px;
  }

  .control-btn {
    width: 65px;
    height: 65px;
    background: #111;
    border: 3px solid #f2a42d;
    border-radius: 10px;
    font-size: 34px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #f2a42d;
    user-select: none;
    box-shadow: 0 0 12px #f2a42d;
  }

  .control-btn:active {
    transform: scale(0.93);
    filter: brightness(1.4);
  }
</style>
</head>

<body>

<div id="game-container">

  <div id="ui">
    Score: <span id="score">0</span> |
    Level: <span id="level">1</span> |
    Time: <span id="time">0</span>s
  </div>

  <canvas id="tetris" width="300" height="600"></canvas>

  <div id="controls">
    <div class="control-btn" id="left">‚¨ÖÔ∏è</div>
    <div class="control-btn" id="rotate">üîÑ</div>
    <div class="control-btn" id="right">‚û°Ô∏è</div>
    <div class="control-btn" id="down">‚¨áÔ∏è</div>
  </div>

</div>

<script>
// CANVAS
const canvas=document.getElementById("tetris");
const ctx=canvas.getContext("2d");

let score=0, level=1, time=0;
let gridW=10, gridH=20, block=30;

let shapes=[
  [[1,1,1,1]],
  [[1,1],[1,1]],
  [[0,1,0],[1,1,1]],
  [[1,0],[1,0],[1,1]],
  [[0,1],[0,1],[1,1]]
];

let colors=["#ff6b6b","#4ecdc4","#ffe66d","#5f27cd","#48dbfb"];

// STARFIELD optimized (less draw cost)
let stars=[];
function initStars(){
  for(let i=0;i<80;i++){
    stars.push({x:Math.random()*canvas.width,
                y:Math.random()*canvas.height,
                s:Math.random()*2,
                sp:0.4+Math.random()*0.5});
  }
}
initStars();

function drawStars(){
  ctx.fillStyle="white";
  for(let s of stars){
    ctx.globalAlpha=0.25;
    ctx.fillRect(s.x,s.y,s.s,s.s);
    s.y+=s.sp;
    if(s.y>canvas.height){ s.y=0; s.x=Math.random()*canvas.width; }
  }
  ctx.globalAlpha=1;
}

// GRID
let grid=[];
function initGrid(){
  grid=Array(gridH).fill().map(()=>Array(gridW).fill(0));
}

// GAME STATE
let piece, px, py;

function newPiece(){
  piece = shapes[Math.random()*shapes.length|0];
  px=3; py=0;
}

function rotate(p){ return p[0].map((_,i)=>p.map(r=>r[i]).reverse()); }

function collides(nx,ny,p){
  for(let y=0;y<p.length;y++){
    for(let x=0;x<p[y].length;x++){
      if(p[y][x] &&
         (nx+x<0||nx+x>=gridW||ny+y>=gridH||grid[ny+y][nx+x])) return true;
    }
  }
  return false;
}

function merge(){
  piece.forEach((r,y)=>r.forEach((v,x)=>{ if(v) grid[py+y][px+x]=1; }));
}

function clearLines(){
  for(let y=gridH-1;y>=0;y--){
    if(grid[y].every(v=>v)){
      grid.splice(y,1);
      grid.unshift(Array(gridW).fill(0));
      score+=100;
      level=Math.floor(score/500)+1;
    }
  }
  document.getElementById("score").textContent=score;
  document.getElementById("level").textContent=level;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawStars();

  // grid
  for(let y=0;y<gridH;y++){
    for(let x=0;x<gridW;x++){
      if(grid[y][x]){
        ctx.fillStyle=colors[(x+y)%5];
        ctx.fillRect(x*block,y*block,block-1,block-1);
      }
    }
  }

  // piece
  piece.forEach((r,y)=>r.forEach((v,x)=>{
    if(v){
      ctx.fillStyle=colors[(x+y)%5];
      ctx.fillRect((px+x)*block,(py+y)*block,block-1,block-1);
    }
  }));
}

// GAME LOOP optimized
let last=0, drop=0;
const DROP_SPEED_BASE=900;

function update(t){
  requestAnimationFrame(update);

  let delta=t-last;
  last=t;
  drop+=delta;

  if(drop > DROP_SPEED_BASE - (level*60)){
    py++;
    drop=0;

    if(collides(px,py,piece)){
      py--;
      merge();
      clearLines();
      newPiece();

      if(collides(px,py,piece)){
        alert("GAME OVER! Score: "+score);
        location.reload();
      }
    }
  }

  draw();
}

initGrid();
newPiece();
update(0);

// TIMER
setInterval(()=>{ time++; document.getElementById("time").textContent=time; },1000);

// TOUCH CONTROLS
document.getElementById("left").onclick=()=>{ if(!collides(px-1,py,piece)) px--; };
document.getElementById("right").onclick=()=>{ if(!collides(px+1,py,piece)) px++; };
document.getElementById("rotate").onclick=()=>{ let r=rotate(piece); if(!collides(px,py,r)) piece=r; };
document.getElementById("down").onclick=()=>{ py++; if(collides(px,py,piece)) py--; };

</script>
</body>
</html>
